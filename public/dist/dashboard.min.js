angular.module("appDashboard",["ngResource","ui.router","ui.bootstrap"]),angular.module("appDashboard").run(["$rootScope","$timeout","$interval",function(n){n.servant={}}]),angular.module("appDashboard").config(["$stateProvider","$urlRouterProvider",function(n,o){o.otherwise("/"),n.state("dashboard",{url:"/",templateUrl:"views/dashboard/dashboard.html"})}]),angular.module("appDashboard").config(["$locationProvider",function(n){n.hashPrefix("!")}]);var environment=$("#dashboard-container").attr("data-dashboard");"development"===environment&&console.log("Environment: Development"),angular.module("appDashboard").controller("DashboardController",["$rootScope","$scope","$timeout","$modal","LeadCapture",function(n,o,e,a,t){o.domains=[],o.tags=[],o.default_tag_index,o.new_domain,o.new_popup,o.new_option={option:"",tag:""},o.new_event="timer",o.field_types=["email","full_name","select"],o.field="email",o.fields={},o.fields.email={type:"email"},o.fields.full_name={type:"full_name"},o.fields.select={type:"select",title:"Untitled Select Field",select_options:[]};var p={title:"Untitled Pop-Up",cta1:"Get Updates",cta2:"Sign up to receive updates about our service",blocks:[o.fields.full_name,o.fields.email],events:[{type:"timer",time:2e3}],default_tags:[]};o.initialize=function(){o.popup_index=0,o.domain_index=0,o.listDomains(),o.$watch("domain_index",function(n,e){n!==e&&(o.popup_index=0)}),o.listTags()},o.saveAndPreview=function(){t.saveDomain(null,o.domains[o.domain_index],function(n){o.domains[o.domain_index]=n,window.location="/preview/"+n.domain_name},function(n){console.log(n)})},o.addField=function(){o.domains[o.domain_index].popups[o.popup_index].blocks.push(o.fields[o.field]),o.field="email",console.log("Field Added: ",o.domains[o.domain_index])},o.addOption=function(n){var e=angular.copy(o.new_option);e.tag=o.tags[o.new_option.tag],o.domains[o.domain_index].popups[o.popup_index].blocks[n].select_options.push(e),o.new_option={option:"",tag:""}},o.addEvent=function(){for(i=0;i<o.domains[o.domain_index].popups[o.popup_index].events.length;i++)if(o.domains[o.domain_index].popups[o.popup_index].events[i].type===o.new_event&&"click"!==o.new_event)return alert("You can only add one of these events");"timer"===o.new_event&&o.domains[o.domain_index].popups[o.popup_index].events.push({type:"timer",time:2e3}),"click"===o.new_event&&o.domains[o.domain_index].popups[o.popup_index].events.push({type:"click",elementID:""}),"scroll"===o.new_event&&o.domains[o.domain_index].popups[o.popup_index].events.push({type:"scroll"}),"exit"===o.new_event&&o.domains[o.domain_index].popups[o.popup_index].events.push({type:"exit"}),o.new_event="timer"},o.addDefaultTag=function(){o.domains[o.domain_index].popups[o.popup_index].default_tags.push(o.tags[o.default_tag_index])},o.moveBlock=function(n,e,i){"up"===i&&e>0&&(o.domains[o.domain_index].popups[o.popup_index].blocks.splice(e,1),o.domains[o.domain_index].popups[o.popup_index].blocks.splice(e-1,0,n)),"down"===i&&e<o.domains[o.domain_index].popups[o.popup_index].blocks.length&&(o.domains[o.domain_index].popups[o.popup_index].blocks.splice(e,1),o.domains[o.domain_index].popups[o.popup_index].blocks.splice(e+1,0,n))},o.listDomains=function(n){t.listDomains(function(e){console.log("Domains Fetched: ",e),o.domains=e,n&&n()},function(n){console.log(n)})},o.setDomain=function(n){o.domain_index=n},o.createDomain=function(){t.createDomain({},{domain_name:o.new_domain},function(){o.listDomains(function(){o.new_domain=""})},function(n){console.log(n)})},o.destroyDomain=function(n){t.destroyDomain({domain_name:n.domain_name},function(){o.listDomains(function(){o.domain_index=0})},function(n){console.log(n)})},o.createPopup=function(){if(o.new_popup&&o.new_popup.length){if(o.domains[o.domain_index].popups&&o.domains[o.domain_index].popups.length>=4)return alert("You have the maximum amount of popups allowed for a domain"),void 0;var n=angular.copy(p);n.title=o.new_popup,o.domains[o.domain_index].popups||(o.domains[o.domain_index].popups=[]),o.domains[o.domain_index].popups.push(n),o.new_popup="",o.popup_index=o.domains[o.domain_index].popups.length-1}},o.setPopup=function(n){o.popup_index=n},o.removePopup=function(n){var e=confirm("Are you sure you want to delete this Pop-Up?");e&&o.domains[o.domain_index].popups.splice(n,1),o.popup_index=o.domains[o.domain_index].popups.length-1},o.listTags=function(){t.listTags(function(n){console.log(n),o.tags=n},function(n){console.log(n)})},o.saveTag=function(){return o.new_tag&&o.new_tag.length?o.tags.length>=40?(alert("You have the maximum amount of tags currently allowed."),!1):(t.saveTag({},{tag:o.new_tag},function(n){console.log(n),o.new_tag="",o.listTags()},function(n){console.log(n)}),void 0):!1},o.removeTag=function(n){var e=confirm("Are you sure you want to delete this Tag?  You will need to edit all ofthe Pop-Ups that use this tag.");e&&t.destroyTag({tagID:n._id},function(n){console.log(n),o.listTags()},function(n){console.log(n)})}}]),angular.module("appDashboard").factory("LeadCapture",["$resource",function(n){return n("",null,{listDomains:{method:"GET",isArray:!0,url:"/domains"},createDomain:{method:"POST",isArray:!1,url:"/domains"},saveDomain:{method:"PUT",isArray:!1,url:"/domains/:domain"},listTags:{method:"GET",isArray:!0,url:"/tags"},saveTag:{method:"POST",isArray:!1,url:"/tags"},destroyTag:{method:"DELETE",isArray:!1,url:"/tags/:tagID"},destroyDomain:{method:"DELETE",isArray:!1,url:"/domains/:domain_name"}})}]);