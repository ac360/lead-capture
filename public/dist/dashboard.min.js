angular.module("appDashboard",["ngResource","ui.router","ui.bootstrap"]),angular.module("appDashboard").run(["$rootScope","$timeout","$interval",function(n){n.servant={}}]),angular.module("appDashboard").config(["$stateProvider","$urlRouterProvider",function(n,e){e.otherwise("/campaigns"),n.state("capture",{url:"/capture",templateUrl:"views/dashboard/capture.html"}),n.state("campaigns",{url:"/campaigns",templateUrl:"views/dashboard/campaigns.html"})}]),angular.module("appDashboard").config(["$locationProvider",function(n){n.hashPrefix("!")}]);var environment=$("#dashboard-container").attr("data-dashboard");"development"===environment&&console.log("Environment: Development"),angular.module("appDashboard").controller("CampaignsController",["$rootScope","$scope","$timeout","$modal","LeadCapture",function(n,e,o,a,i){e.show_campaigns=!1,e.show_templates=!1,e.templates=[],e.new_campaign={autoresponse_template:"",type:"",sequence:[]},e.initialize=function(){e.listCampaigns(),e.listTemplates(),e.campaign=angular.copy(e.new_campaign),console.log(e.campaign)},e.selectCampaign=function(n){e.campaign=n},e.newCampaign=function(){e.campaign=angular.copy(e.new_campaign)},e.listCampaigns=function(){i.listCampaigns(function(n){e.campaigns=n,console.log(e.campaigns)},function(n){console.log(n)})},e.listTemplates=function(){i.listTemplates(function(n){e.templates=n,console.log(e.templates)},function(n){console.log(n)})},e.saveCampaign=function(){return e.campaign.name?(i.saveCampaign({},e.campaign,function(n){console.log(n),e.listCampaigns()},function(n){console.log(n)}),void 0):alert("A campaign name is required.")},e.addToSequence=function(n){e.campaign.sequence.push({template:n.name,number:1,interval:"Days"})},e.moveEmail=function(n,o,a){"up"===a&&o>0&&(e.campaign.sequence.splice(o,1),e.campaign.sequence.splice(o-1,0,n)),"down"===a&&o<e.campaign.sequence.length&&(e.campaign.sequence.splice(o,1),e.campaign.sequence.splice(o+1,0,n))},e.adjustNumber=function(n,o){"up"===o&&e.campaign.sequence[n].number<24&&(e.campaign.sequence[n].number=e.campaign.sequence[n].number+1),"down"===o&&1!==e.campaign.sequence[n].number&&(e.campaign.sequence[n].number=e.campaign.sequence[n].number-1)},e.adjustInterval=function(n){e.campaign.sequence[n].interval="Days"===e.campaign.sequence[n].interval?"Hours":"Days"}}]),angular.module("appDashboard").controller("CaptureController",["$rootScope","$scope","$timeout","$modal","LeadCapture",function(n,e,o,a,t){e.domains=[],e.tags=[],e.default_tag_index,e.new_domain,e.new_popup,e.new_option={option:"",tag:""},e.new_event="timer",e.field_types=["email","full_name","select"],e.field="email",e.fields={},e.fields.email={type:"email"},e.fields.full_name={type:"full_name"},e.fields.select={type:"select",title:"Untitled Select Field",select_options:[]};var p={title:"Untitled Pop-Up",cta1:"Get Updates",cta2:"Sign up to receive updates about our service",blocks:[e.fields.full_name,e.fields.email],events:[{type:"timer",time:2e3}],default_tags:[]};e.initialize=function(){e.popup_index=0,e.domain_index=0,e.listDomains(),e.$watch("domain_index",function(n,o){n!==o&&(e.popup_index=0)}),e.listTags()},e.saveAndPreview=function(){t.saveDomain(null,e.domains[e.domain_index],function(n){e.domains[e.domain_index]=n,window.location="/preview/"+n.domain_name},function(n){console.log(n)})},e.addField=function(){e.domains[e.domain_index].popups[e.popup_index].blocks.push(e.fields[e.field]),e.field="email",console.log("Field Added: ",e.domains[e.domain_index])},e.addOption=function(n){var o=angular.copy(e.new_option);o.tag=e.tags[e.new_option.tag],e.domains[e.domain_index].popups[e.popup_index].blocks[n].select_options.push(o),e.new_option={option:"",tag:""}},e.addEvent=function(){for(i=0;i<e.domains[e.domain_index].popups[e.popup_index].events.length;i++)if(e.domains[e.domain_index].popups[e.popup_index].events[i].type===e.new_event&&"click"!==e.new_event)return alert("You can only add one of these events");"timer"===e.new_event&&e.domains[e.domain_index].popups[e.popup_index].events.push({type:"timer",time:2e3}),"click"===e.new_event&&e.domains[e.domain_index].popups[e.popup_index].events.push({type:"click",elementID:""}),"scroll"===e.new_event&&e.domains[e.domain_index].popups[e.popup_index].events.push({type:"scroll"}),"exit"===e.new_event&&e.domains[e.domain_index].popups[e.popup_index].events.push({type:"exit"}),e.new_event="timer"},e.addDefaultTag=function(){e.domains[e.domain_index].popups[e.popup_index].default_tags.push(e.tags[e.default_tag_index])},e.moveBlock=function(n,o,a){"up"===a&&o>0&&(e.domains[e.domain_index].popups[e.popup_index].blocks.splice(o,1),e.domains[e.domain_index].popups[e.popup_index].blocks.splice(o-1,0,n)),"down"===a&&o<e.domains[e.domain_index].popups[e.popup_index].blocks.length&&(e.domains[e.domain_index].popups[e.popup_index].blocks.splice(o,1),e.domains[e.domain_index].popups[e.popup_index].blocks.splice(o+1,0,n))},e.listDomains=function(n){t.listDomains(function(o){console.log("Domains Fetched: ",o),e.domains=o,n&&n()},function(n){console.log(n)})},e.setDomainIndex=function(n){e.domain_index=n},e.createDomain=function(){t.createDomain({},{domain_name:e.new_domain},function(){e.listDomains(function(){e.new_domain=""})},function(n){console.log(n)})},e.destroyDomain=function(n){t.destroyDomain({domain_name:n.domain_name},function(){e.listDomains(function(){e.domain_index=0})},function(n){console.log(n)})},e.createPopup=function(){if(e.new_popup&&e.new_popup.length){if(e.domains[e.domain_index].popups&&e.domains[e.domain_index].popups.length>=4)return alert("You have the maximum amount of popups allowed for a domain"),void 0;var n=angular.copy(p);n.title=e.new_popup,e.domains[e.domain_index].popups||(e.domains[e.domain_index].popups=[]),e.domains[e.domain_index].popups.push(n),e.new_popup="",e.popup_index=e.domains[e.domain_index].popups.length-1}},e.setPopupIndex=function(n){e.popup_index=n},e.removePopup=function(n){var o=confirm("Are you sure you want to delete this Pop-Up?");o&&e.domains[e.domain_index].popups.splice(n,1),e.popup_index=e.domains[e.domain_index].popups.length-1},e.listTags=function(){t.listTags(function(n){console.log(n),e.tags=n},function(n){console.log(n)})},e.saveTag=function(){return e.new_tag&&e.new_tag.length?e.tags.length>=40?(alert("You have the maximum amount of tags currently allowed."),!1):(t.saveTag({},{tag:e.new_tag},function(n){console.log(n),e.new_tag="",e.listTags()},function(n){console.log(n)}),void 0):!1},e.removeTag=function(n){var o=confirm("Are you sure you want to delete this Tag?  You will need to edit all ofthe Pop-Ups that use this tag.");o&&t.destroyTag({tagID:n._id},function(n){console.log(n),e.listTags()},function(n){console.log(n)})}}]),angular.module("appDashboard").factory("LeadCapture",["$resource",function(n){return n("",null,{listDomains:{method:"GET",isArray:!0,url:"/domains"},createDomain:{method:"POST",isArray:!1,url:"/domains"},saveDomain:{method:"PUT",isArray:!1,url:"/domains/:domain_name"},listTags:{method:"GET",isArray:!0,url:"/tags"},saveTag:{method:"POST",isArray:!1,url:"/tags"},destroyTag:{method:"DELETE",isArray:!1,url:"/tags/:tagID"},destroyDomain:{method:"DELETE",isArray:!1,url:"/domains/:domain_name"},listTemplates:{method:"GET",isArray:!0,url:"/templates"},listCampaigns:{method:"GET",isArray:!0,url:"/campaigns"},saveCampaign:{method:"POST",isArray:!1,url:"/campaigns"}})}]);